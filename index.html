<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background-color: #2d89ef;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      flex: 1;
      gap: 1rem;
      padding: 1rem;
      box-sizing: border-box;
    }

    .widget {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      padding: 1rem;
      overflow: auto;
    }

    .calendar-widget {
      grid-column: 1 / 3;
      grid-row: 1;
    }

    .todo-widget {
      grid-column: 1;
      grid-row: 2;
    }

    .grocery-widget {
      grid-column: 2;
      grid-row: 2;
    }

    iframe {
      border: 0;
      width: 100%;
      height: 100%;
      border-radius: 10px;
    }

    h2 {
      margin-top: 0;
      text-align: center;
    }

    .add-item-container {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }

    .add-item-container input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .add-item-container button {
      padding: 8px 16px;
      background-color: #2d89ef;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .add-item-container button:hover {
      background-color: #1e6bc7;
    }

    .task-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .task-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      gap: 10px;
    }

    .task-item:last-child {
      border-bottom: none;
    }

    .task-checkbox {
      margin-right: 8px;
      transform: scale(1.2);
    }

    .task-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .task-text.completed {
      text-decoration: line-through;
      color: #888;
    }

    .task-actions {
      display: flex;
      gap: 5px;
    }

    .delete-btn, .edit-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 12px;
      transition: background-color 0.2s;
    }

    .delete-btn {
      color: #dc3545;
    }

    .delete-btn:hover {
      background-color: #f8d7da;
    }

    .edit-btn {
      color: #007bff;
    }

    .edit-btn:hover {
      background-color: #d1ecf1;
    }

    .empty-state {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 20px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .add-item-container {
        flex-direction: column;
      }
      
      .add-item-container button {
        padding: 12px;
      }
      
      .task-item {
        padding: 12px 0;
      }
      
      .task-text {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <header>Bennett Hub</header>
  <main>
    <!-- Google Calendar -->
    <div class="widget calendar-widget">
      <h2>Calendar</h2>
      <iframe src="https://calendar.google.com/calendar/embed?src=holcombe.emley%40gmail.com&ctz=America%2FDenver"></iframe>

    </div>

    <!-- To-Do List -->
    <div class="widget todo-widget">
      <h2>To-Do List</h2>
      <div class="add-item-container">
        <input type="text" id="todo-input" placeholder="Add new task..." maxlength="100">
        <button onclick="addTodoItem()" id="add-todo-btn">Add</button>
      </div>
      <ul id="todo-list" class="task-list">
        <!-- Dynamic content will be loaded here -->
      </ul>
    </div>

    <!-- Grocery List -->
    <div class="widget grocery-widget">
      <h2>Grocery List</h2>
      <div class="add-item-container">
        <input type="text" id="grocery-input" placeholder="Add grocery item..." maxlength="100">
        <button onclick="addGroceryItem()" id="add-grocery-btn">Add</button>
      </div>
      <ul id="grocery-list" class="task-list">
        <!-- Dynamic content will be loaded here -->
      </ul>
    </div>
  </main>

  <script>
    // Data storage
    let todoItems = JSON.parse(localStorage.getItem('todoItems')) || [];
    let groceryItems = JSON.parse(localStorage.getItem('groceryItems')) || [];

    // Initialize lists on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Clean up old completed items first
      cleanupCompletedItems();
      
      renderTodoList();
      renderGroceryList();
      
      // Add Enter key support for inputs
      document.getElementById('todo-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addTodoItem();
        }
      });
      
      document.getElementById('grocery-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addGroceryItem();
        }
      });

      // Set up automatic cleanup at midnight
      scheduleNextCleanup();
    });

    // Todo List Functions
    function addTodoItem() {
      const input = document.getElementById('todo-input');
      const text = input.value.trim();
      
      if (text) {
        const item = {
          id: Date.now(),
          text: text,
          completed: false,
          createdAt: new Date().toISOString()
        };
        
        todoItems.unshift(item); // Add to beginning of array
        saveTodoItems();
        renderTodoList();
        input.value = '';
      }
    }

    function toggleTodoItem(id) {
      const item = todoItems.find(item => item.id === id);
      if (item) {
        item.completed = !item.completed;
        if (item.completed) {
          item.completedAt = new Date().toISOString();
        } else {
          delete item.completedAt;
        }
        saveTodoItems();
        renderTodoList();
      }
    }

    function deleteTodoItem(id) {
      todoItems = todoItems.filter(item => item.id !== id);
      saveTodoItems();
      renderTodoList();
    }

    function editTodoItem(id) {
      const item = todoItems.find(item => item.id === id);
      if (item) {
        const newText = prompt('Edit task:', item.text);
        if (newText !== null && newText.trim()) {
          item.text = newText.trim();
          saveTodoItems();
          renderTodoList();
        }
      }
    }

    function renderTodoList() {
      const list = document.getElementById('todo-list');
      
      if (todoItems.length === 0) {
        list.innerHTML = '<li class="empty-state">No tasks yet. Add one above!</li>';
        return;
      }
      
      list.innerHTML = todoItems.map(item => `
        <li class="task-item">
          <input type="checkbox" class="task-checkbox" 
                 ${item.completed ? 'checked' : ''} 
                 onchange="toggleTodoItem(${item.id})">
          <span class="task-text ${item.completed ? 'completed' : ''}">${escapeHtml(item.text)}</span>
          <div class="task-actions">
            <button class="edit-btn" onclick="editTodoItem(${item.id})" title="Edit">‚úèÔ∏è</button>
            <button class="delete-btn" onclick="deleteTodoItem(${item.id})" title="Delete">üóëÔ∏è</button>
          </div>
        </li>
      `).join('');
    }

    function saveTodoItems() {
      localStorage.setItem('todoItems', JSON.stringify(todoItems));
    }

    // Grocery List Functions
    function addGroceryItem() {
      const input = document.getElementById('grocery-input');
      const text = input.value.trim();
      
      if (text) {
        const item = {
          id: Date.now(),
          text: text,
          completed: false,
          createdAt: new Date().toISOString()
        };
        
        groceryItems.unshift(item); // Add to beginning of array
        saveGroceryItems();
        renderGroceryList();
        input.value = '';
      }
    }

    function toggleGroceryItem(id) {
      const item = groceryItems.find(item => item.id === id);
      if (item) {
        item.completed = !item.completed;
        if (item.completed) {
          item.completedAt = new Date().toISOString();
        } else {
          delete item.completedAt;
        }
        saveGroceryItems();
        renderGroceryList();
      }
    }

    function deleteGroceryItem(id) {
      groceryItems = groceryItems.filter(item => item.id !== id);
      saveGroceryItems();
      renderGroceryList();
    }

    function editGroceryItem(id) {
      const item = groceryItems.find(item => item.id === id);
      if (item) {
        const newText = prompt('Edit item:', item.text);
        if (newText !== null && newText.trim()) {
          item.text = newText.trim();
          saveGroceryItems();
          renderGroceryList();
        }
      }
    }

    function renderGroceryList() {
      const list = document.getElementById('grocery-list');
      
      if (groceryItems.length === 0) {
        list.innerHTML = '<li class="empty-state">No items yet. Add one above!</li>';
        return;
      }
      
      list.innerHTML = groceryItems.map(item => `
        <li class="task-item">
          <input type="checkbox" class="task-checkbox" 
                 ${item.completed ? 'checked' : ''} 
                 onchange="toggleGroceryItem(${item.id})">
          <span class="task-text ${item.completed ? 'completed' : ''}">${escapeHtml(item.text)}</span>
          <div class="task-actions">
            <button class="edit-btn" onclick="editGroceryItem(${item.id})" title="Edit">‚úèÔ∏è</button>
            <button class="delete-btn" onclick="deleteGroceryItem(${item.id})" title="Delete">üóëÔ∏è</button>
          </div>
        </li>
      `).join('');
    }

    function saveGroceryItems() {
      localStorage.setItem('groceryItems', JSON.stringify(groceryItems));
    }

    // Utility function to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Cleanup functions for completed items
    function cleanupCompletedItems() {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      
      // Clean up todo items
      const originalTodoCount = todoItems.length;
      todoItems = todoItems.filter(item => {
        if (!item.completed || !item.completedAt) return true;
        
        const completedDate = new Date(item.completedAt);
        const completedDay = new Date(completedDate.getFullYear(), completedDate.getMonth(), completedDate.getDate());
        
        // Keep items completed today, remove items completed before today
        return completedDay.getTime() >= today.getTime();
      });
      
      // Clean up grocery items
      const originalGroceryCount = groceryItems.length;
      groceryItems = groceryItems.filter(item => {
        if (!item.completed || !item.completedAt) return true;
        
        const completedDate = new Date(item.completedAt);
        const completedDay = new Date(completedDate.getFullYear(), completedDate.getMonth(), completedDate.getDate());
        
        // Keep items completed today, remove items completed before today
        return completedDay.getTime() >= today.getTime();
      });
      
      // Save if any items were removed
      if (todoItems.length !== originalTodoCount) {
        saveTodoItems();
      }
      if (groceryItems.length !== originalGroceryCount) {
        saveGroceryItems();
      }
      
      // Log cleanup activity (optional, for debugging)
      const todoRemoved = originalTodoCount - todoItems.length;
      const groceryRemoved = originalGroceryCount - groceryItems.length;
      if (todoRemoved > 0 || groceryRemoved > 0) {
        console.log(`Cleaned up ${todoRemoved} completed todo items and ${groceryRemoved} completed grocery items`);
      }
    }

    function scheduleNextCleanup() {
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(0, 0, 1, 0); // 12:00:01 AM tomorrow
      
      const msUntilMidnight = tomorrow.getTime() - now.getTime();
      
      setTimeout(() => {
        cleanupCompletedItems();
        renderTodoList();
        renderGroceryList();
        
        // Schedule the next cleanup (24 hours later)
        scheduleNextCleanup();
      }, msUntilMidnight);
      
      console.log(`Next automatic cleanup scheduled for: ${tomorrow.toLocaleString()}`);
    }

    // Optional: Auto-save feature and data export/import for sharing between devices
    function exportData() {
      const data = {
        todoItems: todoItems,
        groceryItems: groceryItems,
        exportDate: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'smart-dashboard-lists.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importData(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            if (data.todoItems && data.groceryItems) {
              todoItems = data.todoItems;
              groceryItems = data.groceryItems;
              saveTodoItems();
              saveGroceryItems();
              renderTodoList();
              renderGroceryList();
              alert('Data imported successfully!');
            }
          } catch (err) {
            alert('Error importing data. Please check the file format.');
          }
        };
        reader.readAsText(file);
      }
    }
  </script>
</body>
</html>
